generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ObligationCategory {
  payment
  legal
  other
}

enum ObligationFrequency {
  once
  monthly
  quarterly
  yearly
  custom
}

enum RecurrenceUnit {
  week
  month
}

enum DigitalAccountCategory {
  email
  cloud
  streaming
  social
  dev_tool
  other
}

enum SubscriptionPeriod {
  monthly
  quarterly
  semiannual
  yearly
  lifetime
}

enum AssetKind {
  liquid
  stable
  personal_valuable
}

model User {
  id        String   @id @default(uuid())
  email     String?  @unique
  name      String?
  masterKeyHash String?
  createdAt DateTime @default(now())

  assets               Asset[]
  obligations          Obligation[]
  reminders            Reminder[]
  journal              JournalEntry[]
  pageLayouts          PageLayout[]
  workspaceColumns     WorkspaceColumn[]
  workspaceCards       WorkspaceCard[]
  digitalAccounts      DigitalAccount[]
  digitalSubscriptions DigitalSubscription[]
  incomes              CashflowIncome[]
}

model Asset {
  id              String    @id @default(uuid())
  userId          String?
  name            String
  assetKind       AssetKind @default(liquid)
  assetType       String
  isLiquid        Boolean
  currentValue    Decimal   @db.Decimal(18, 2)
  currency        String    @default("TRY") @db.Char(3)
  acquisitionDate DateTime? @db.Date
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @default(now()) @updatedAt

  user           User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  journalEntries JournalEntry[]
}

model Obligation {
  id                 String              @id @default(uuid())
  userId             String?
  name               String
  category           ObligationCategory
  amount             Decimal?            @db.Decimal(18, 2)
  isBelli            Boolean             @default(false)
  currency           String?             @db.Char(3)
  frequency          ObligationFrequency @default(once)
  isRecurring        Boolean             @default(false)
  isDone             Boolean             @default(false)
  recurrenceInterval Int?
  recurrenceUnit     RecurrenceUnit?
  nextDue            DateTime?           @db.Date
  endDate            DateTime?           @db.Date
  notes              String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @default(now()) @updatedAt

  user             User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  digitalAccount   DigitalAccount? @relation(fields: [digitalAccountId], references: [id], onDelete: Cascade)
  digitalAccountId String?
  reminders        Reminder[]      @relation("ReminderObligation")
  journal          JournalEntry[]

  @@index([digitalAccountId])
}

model Reminder {
  id                  String    @id @default(uuid())
  userId              String?
  title               String
  description         String?
  startAt             DateTime?
  dueAt               DateTime
  isVeryImportant     Boolean   @default(false)
  isDone              Boolean   @default(false)
  relatedObligationId String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @default(now()) @updatedAt

  user              User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  relatedObligation Obligation? @relation("ReminderObligation", fields: [relatedObligationId], references: [id], onDelete: SetNull)

  @@index([dueAt])
  @@index([isVeryImportant, dueAt])
}

model JournalEntry {
  id                  String   @id @default(uuid())
  userId              String?
  title               String?
  body                String
  entryDate           DateTime @default(now()) @db.Date
  relatedAssetId      String?
  relatedObligationId String?
  createdAt           DateTime @default(now())

  user              User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  relatedAsset      Asset?      @relation(fields: [relatedAssetId], references: [id], onDelete: SetNull)
  relatedObligation Obligation? @relation(fields: [relatedObligationId], references: [id], onDelete: SetNull)

  @@index([entryDate])
}

model PageLayout {
  id        String   @id @default(uuid())
  userId    String?
  pageKey   String
  layout    Json
  updatedAt DateTime @default(now()) @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, pageKey])
}

model WorkspaceColumn {
  id        String   @id @default(uuid())
  userId    String?
  title     String
  color     String?
  width     Int      @default(1)
  position  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  user  User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  cards WorkspaceCard[]

  @@index([userId, position])
}

model WorkspaceCard {
  id        String   @id @default(uuid())
  columnId  String
  userId    String?
  title     String
  notes     String?  @db.Text
  position  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  column WorkspaceColumn @relation(fields: [columnId], references: [id], onDelete: Cascade)
  user   User?           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([columnId, position])
}

model DigitalAccount {
  id                  String                  @id @default(uuid())
  userId              String?
  providerName        String
  accountIdentifier   String
  loginUrl            String?
  category            DigitalAccountCategory?
  isPremium           Boolean                 @default(false)
  notes               String?
  passwordHint        String?
  passwordLastChanged DateTime?               @db.Date
  encryptedPassword   String?                 @db.Text
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @default(now()) @updatedAt

  user         User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription DigitalSubscription?
  obligations  Obligation[]
}

model DigitalSubscription {
  id               String             @id @default(uuid())
  digitalAccountId String             @unique
  userId           String?
  amount           Decimal            @db.Decimal(18, 2)
  currency         String             @db.Char(3)
  period           SubscriptionPeriod
  firstDue         DateTime           @db.Date
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt

  account DigitalAccount @relation(fields: [digitalAccountId], references: [id], onDelete: Cascade)
  user    User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CashflowIncome {
  id         String   @id @default(uuid())
  userId     String?
  title      String
  category   String
  amount     Decimal  @db.Decimal(18, 2)
  currency   String   @default("TRY") @db.Char(3)
  occurredAt DateTime @db.Date
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)
}
